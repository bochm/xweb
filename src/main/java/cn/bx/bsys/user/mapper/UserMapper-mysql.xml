<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.bx.bsys.user.mapper.UserMapper"> 
	
    <sql id="userColumns">
    	a.id,
    	a.company_id,
    	a.dept_id,
    	a.login_name,
    	a.password,
    	a.no,
		a.name,
		a.email,
		a.phone,
		a.mobile,
		a.user_type,
		a.login_ip,
		a.login_date,
		a.remarks,
		a.login_flag,
		a.photo,
		a.status
    </sql>
    <!-- 根据登录名查询用户 -->
    
	<select id="findUserByLoginName" resultType="cn.bx.bframe.system.entity.User">
		SELECT
		<include refid="userColumns"/>
		FROM sys_user a
		WHERE a.login_name = #{loginname}
	</select>
	<select id="listUser" resultType="cn.bx.bframe.system.entity.User">
		SELECT
		<include refid="userColumns"/>
		FROM sys_user a
	</select>
	<insert id="addUser">
		INSERT INTO sys_user(
			id, 
			company_id, 
			dept_id, 
			login_name, 
			password, 
			no, 
			name, 
			email, 
			phone, 
			mobile, 
			user_type, 
			create_by, 
			create_date, 
			update_by, 
			update_date, 
			remarks, 
			login_flag, 
			photo
		) VALUES (
			#{id}, 
			111, 
			222, 
			#{loginName}, 
			#{password}, 
			#{no}, 
			#{name}, 
			#{email}, 
			#{tel}, 
			#{mobile}, 
			#{userType}, 
			1, 
			#{createDate}, 
			1, 
			#{updateDate}, 
			#{remarks}, 
			#{loginFlag}, 
			#{photo}
		)
	</insert>
	
	<update id="saveUser">
		update sys_user set
		login_name = #{loginName}, 
		<if test="password != null and password != ''">
		password = #{password}, 
		</if>
		no = #{no}, 
		name = #{name}, 
		email = #{email}, 
		phone = #{tel}, 
		mobile = #{mobile}, 
		user_type = #{userType}, 
		update_by = #{updateBy}, 
		update_date = #{updateDate}, 
		login_flag = #{loginFlag},
		photo = #{photo},
		remarks = #{remarks}
		WHERE id = #{id}
	</update>
	
	<delete id="deleteUser">
		delete from  sys_user where id in
		<foreach collection="array" item="id" open="(" close=")" separator=",">#{id}</foreach>
	</delete>
	
	<select id="checkUserExists" resultType="hashmap">
		select id from  sys_user where login_name = #{value}
	</select>
</mapper>